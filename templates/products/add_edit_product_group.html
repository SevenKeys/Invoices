{% extends "base.html" %}

{% load extra_products %}
{% block content %}
	<!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Delete group</h4>
          </div>
          <div class="modal-body">
            Are you sure you want to delete this group?
          </div>
          <div class="modal-footer">
            <button class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button id="productgroup_{{ object.id }}" class="btn btn-primary">Yes, delete</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Form -->
	<form class="form-contact" action="" method="POST" style="margin-right:auto; margin-left:auto; width:70%">
		<div class="row">
		    {% if not edit %}
		        <h2 class="col-md-10 col-md-offset-4">Add a new product group</h2>
		    {% else %}
		        <h2 class="col-md-10 col-md-offset-4">Edit product group</h2>
		    {% endif %}
	   </div>
		{% csrf_token %} 
		{% for hidden in form.hidden_fields %}
			{{ hidden }}
		{% endfor %}
		{% for field in form.visible_fields %}
		
		{% if field.errors %}
		    <fieldset class="form-group {% add_css_class 'has-error' %}" >
		    <ol>
		    {% for error in field.errors %}
		        <li><strong>{{ error|escape }}</strong></li>
		    {% endfor %}
		    </ol>
		{% elif field.value %}
		  <fieldset class="form-group {% add_css_class 'has-success' %}" >
		{% else %}
		  <fieldset class="form-group" >
		{% endif %}

		  <div class="col-md-3">
			<label class="control-label" for="id_{{ field.name }}">{{ field.label }}:
			{% if not field.field.required %}
			  <span class="special_class">(optional)</span>
		  	{% endif %}
	        {% for error in field.errors %}
	          <strong>{{ error|escape }}</strong>
	        {% endfor %}
			</label>
		      <p class="help-text">{{ field.help_text }}</p>
	      </div>
	      <div class="col-md-9">{{ field | addcss:'form-control' }}</div>
		
		  </fieldset>
		{% endfor %}
	    <div class="col-md-2 col-md-offset-7">
		{% if edit %}
		  <!-- Button trigger modal -->
		  <input type="button" id="product_{{ object.id }}" class="btn tm_style_2" data-toggle="modal" data-target="#myModal" value="Delete Group" style="margin-right:auto;margin-left:auto">
		{% endif %}
        </div>
        <div class="col-md-2 col-md-offset-1">
		   <input type="submit" value="Submit"  class="btn btn-primary">
        </div>
	    </form>
{% endblock %}
{% block scripts %}
{% if edit %}
    <script type="text/javascript">
	    $(function(){
			function getCookie(name) {
		    var cookieValue = null;
		    if (document.cookie && document.cookie != '') {
		        var cookies = document.cookie.split(';');
		        for (var i = 0; i < cookies.length; i++) {
		            var cookie = jQuery.trim(cookies[i]);
		            // Does this cookie string begin with the name we want?
		            if (cookie.substring(0, name.length + 1) == (name + '=')) {
		                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
		                break;
		            }
		        }
		    }
		    return cookieValue;
		}
		var csrftoken = getCookie('csrftoken');

		$button = $('#productgroup_{{ object.id }}')
    	$button.click(function(){
	    	$.ajax({
	    		type: 'POST',
	    		url: '/products/delete_group/{{ object.id }}/',
	    		data: {
    			'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val()
	    		},
	    		success: function(){
		    		window.location.href = '/products/all/'
	    		} 
	    	});
	    });
    });
    </script>
{% endif %}
{% endblock %}