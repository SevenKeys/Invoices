{% extends "base.html" %}

{% block content %}
    {% if company %}
        <h2>Clients of <strong>{{ company }}</strong> company.</h2>
            {% csrf_token %}
            {% if customer_list.count > 0 %}
                                    
            {% else %}
                <h3>No clients was added yet.</h3>
            {% endif %}
        </ul>
        <a class="btn btn-primary pull-right" href="{% url 'add_customer' %}">Add client</a>
        <div id="customersGrid" style="min-height: 250px;"></div>
        <br/><br/>

        <a class="btn btn-primary pull-right" href="{% url 'add_group' %}">Add client group</a>
        <div id="customerGroupsGrid" style="min-height: 250px;"></div>
    {% else %}
        <h3>You have not registered a company yet.</h3>
        <a href="{% url 'add_company' %}" class="btn btn-info tm_style_2">Create company</a>
    {% endif %}
{% endblock %}

{% block scripts %}
        <script>
            $(function() {
                $("#customerGroupsGrid").jsGrid({
                    height: "100%",
                    width: "100%",
                    sorting: true,
                    paging: true,
                    autoload: true,
                    pageSize: 10,
                    pageButtonCount: 5,
                    filtering: true,
                    rowClick: function(args) {
                        return window.location.replace("/customers/edit_group/"+args.item.id);
                    },
                    controller: {
                        loadData: function(filter) {
                            var d = $.Deferred();
                            $.ajax({
                                type: "GET",
                                url: "/customers/list_group/",
                                data: filter
                            }).done(function(result) {
                                d.resolve($.map(result, function(item) {
                                    return $.extend(item.fields, { id: item.pk });
                                }));
                            });
                            return d.promise();
                        }
                    },
                    fields: [
                        { name: "name", type: "text", width: 150 },
                        { name: "parent", type: "text", width: 150 },
                        { name: "category", type: "text", width: 100 }
                    ]
                });
            });

            $(function() {
                $("#customersGrid").jsGrid({
                    height: "100%",
                    width: "100%",
                    sorting: true,
                    paging: true,
                    autoload: true,
                    pageSize: 10,
                    pageButtonCount: 5,
                    filtering: true,
                    rowClick: function(args) {
                        return window.location.replace("/customers/edit/"+args.item.id);
                    },
                    controller: {
                        loadData: function(filter) {
                            var d = $.Deferred();
                            $.ajax({
                                type: "GET",
                                url: "/customers/list/",
                                data: filter
                            }).done(function(result) {
                                d.resolve($.map(result, function(item) {
                                    return $.extend(item.fields, { id: item.pk });
                                }));
                            });
                            return d.promise();
                        }
                    },
                    fields: [
                        { name: "name", type: "text", width: 150 },
                        { name: "status", type: "text", width: 150 },
                        { name: "client_type", type: "text", width: 100 },
                        { name: "company_segment", type: "text", width: 100 }
                    ]
                });
            });
        </script>

{% endblock %}
