{% extends "base.html" %}
{% block content %}

{% if currency_list.count > 0 %}
	<h2>List of currencies</h2>
	<ul class="list-group">
	{% for currency in currency_list %}
		<li class="list-group-item">{{ currency.name }}
	        <a class="btn btn-primary pull-right" href="" style="">Delete</a>
	    </li>
	{% endfor %}
	</ul>
{% else %}

	<h3>No currencies was added yet</h3>

{% endif %}
	<form action="" method="POST">
	{% csrf_token %}
	    <input type="button" class="btn btn-primary" id="addCur" style="" value="Add New Currency"/>
	</form>

{% endblock %}

{% block scripts %}
    <script type="text/javascript">
        $(function(){
            function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) == (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        var csrftoken = getCookie('csrftoken');
        // add new currency after click with ajax
        var refreshPage = function(){
        	window.location.reload(true);
        }
        $add = $('#addCur');
        $add.click(function(){
            var name = prompt("Please, enter a new currency");
            $.ajax({
                type: 'POST',
                url: '/products/add_currency/',
                data: {
                	'name': name,
                    'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val()
                },
                dataType: 'json'
            });
            refreshPage();
        });
        // delete any currency from list
        $button = $('#currency_{{ field.id }}');
        $button.click(function(){
            if (confirm("Are you sure you want to delete this product?") == true){
                $.ajax({
                    type: 'POST',
                    url: '/products/delete/{{ object.id }}/',
                    data: {
                    'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val()
                    },
                    success: function(){
                        window.location.href = '/products/all/'
                    }
                });
            }
        });
    });
    </script>

{% endblock %}